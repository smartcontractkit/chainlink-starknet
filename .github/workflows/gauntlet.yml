name: gauntlet

on:
  push:
    branches:
      - develop
      - main
  pull_request:

jobs:
  gauntlet_build:
    name: Gauntlet Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout sources
        uses: actions/checkout@v3.0.2
      - name: Install Nix
        uses: cachix/install-nix-action@v17
        with:
          nix_path: nixpkgs=channel:nixos-unstable

      - name: Install
        run: nix develop -c yarn install --frozen-lockfile

      - name: Build
        run: nix develop -c yarn build

      - name: Run Gauntlet
        run: nix develop -c yarn gauntlet

  gauntlet_format:
    name: Gauntlet Format
    runs-on: ubuntu-latest
    steps:
      - name: Checkout sources
        uses: actions/checkout@v3.0.2
      - name: Install Nix
        uses: cachix/install-nix-action@v17
        with:
          nix_path: nixpkgs=channel:nixos-unstable

      - name: Install
        run: nix develop -c yarn install --frozen-lockfile

      - name: Format Check
        run: nix develop -c yarn format:check

  gauntlet_run_tests:
    name: Gauntlet Run Tests
    runs-on: ubuntu-latest
    steps:
      - name: Checkout sources
        uses: actions/checkout@v3.0.2
      - name: Install Nix
        uses: cachix/install-nix-action@v17
        with:
          nix_path: nixpkgs=channel:nixos-unstable

      - name: Install
        run: nix develop -c yarn install --frozen-lockfile

      - name: Test
        run: nix develop -c yarn test
